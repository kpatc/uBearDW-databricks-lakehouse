# Debezium Server Configuration for Google Cloud Pub/Sub
# =============================================================================

# Debezium Source - PostgreSQL
# =============================================================================
debezium.source.connector.class=io.debezium.connector.postgresql.PostgresConnector
debezium.source.offset.storage.file.filename=/debezium/data/offsets.dat
debezium.source.offset.flush.interval.ms=10000

# PostgreSQL Connection
debezium.source.database.hostname=35.189.224.202
debezium.source.database.port=5432
debezium.source.database.user=foodapp
debezium.source.database.password=UbearSecure2024!Morocco
debezium.source.database.dbname=foodapp

# PostgreSQL CDC Configuration
debezium.source.plugin.name=pgoutput
debezium.source.slot.name=debezium_slot_ubear_kafka
debezium.source.publication.name=dbz_publication_ubear

# Topic naming
debezium.source.topic.prefix=dbserver1

# Tables to capture
debezium.source.table.include.list=public.eater,public.merchant,public.courier,public.trip_events

# Schema changes
debezium.source.include.schema.changes=true

# Snapshot mode - initial_only = snapshot then stop, streaming forever
# Changed from 'initial' to continue streaming after snapshot
# Remove this line or set to 'always' for continuous CDC
# debezium.source.snapshot.mode=initial

# =============================================================================
# Debezium Sink - Confluent Cloud Kafka
# =============================================================================
debezium.sink.type=kafka
debezium.sink.kafka.producer.bootstrap.servers=pkc-z1o60.europe-west1.gcp.confluent.cloud:9092
debezium.sink.kafka.producer.key.serializer=org.apache.kafka.common.serialization.StringSerializer
debezium.sink.kafka.producer.value.serializer=org.apache.kafka.common.serialization.StringSerializer

# Confluent Cloud Authentication (SASL_SSL)
debezium.sink.kafka.producer.security.protocol=SASL_SSL
debezium.sink.kafka.producer.sasl.mechanism=PLAIN
debezium.sink.kafka.producer.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="HYPO6LDVPLC2EAYE" password="cfltDnW60V6dsBmYpBFAjnAaQq+lA70I7tim4/XLDCftn0jMqMxAfx4AxdaiC9Iw";

# Kafka producer configuration
debezium.sink.kafka.producer.acks=1
debezium.sink.kafka.producer.compression.type=snappy
debezium.sink.kafka.producer.linger.ms=10

# Topic mapping avec transformation
# dbserver1.public.eater -> ubear.public.eater
# dbserver1.public.merchant -> ubear.public.merchant
# dbserver1.public.courier -> ubear.public.courier
# dbserver1.public.trip_events -> ubear.public.trip_events

# =============================================================================
# Format Configuration
# =============================================================================
debezium.format.key=json
debezium.format.value=json

# =============================================================================
# Transforms - Router pour renommer les topics
# =============================================================================
debezium.transforms=route
debezium.transforms.route.type=io.debezium.transforms.ByLogicalTableRouter
debezium.transforms.route.topic.regex=dbserver1\\.public\\.(.*)
debezium.transforms.route.topic.replacement=ubear.public.$1

# =============================================================================
# Logging
# =============================================================================
quarkus.log.level=INFO
quarkus.log.console.enable=true
quarkus.log.console.json=false

# =============================================================================
# Error Handling
# =============================================================================
debezium.source.errors.max.retries=3
debezium.source.errors.retry.delay.initial.ms=1000
debezium.source.errors.retry.delay.max.ms=30000

# =============================================================================
# Performance Tuning
# =============================================================================
debezium.source.max.batch.size=2048
debezium.source.max.queue.size=8192
debezium.source.poll.interval.ms=500
