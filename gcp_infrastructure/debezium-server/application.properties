# Debezium Server Configuration for Google Cloud Pub/Sub
# =============================================================================

# Debezium Source - PostgreSQL
# =============================================================================
debezium.source.connector.class=io.debezium.connector.postgresql.PostgresConnector
debezium.source.offset.storage.file.filename=/debezium/data/offsets.dat
debezium.source.offset.flush.interval.ms=10000

# PostgreSQL Connection
debezium.source.database.hostname=35.189.224.202
debezium.source.database.port=5432
debezium.source.database.user=foodapp
debezium.source.database.password=UbearSecure2024!Morocco
debezium.source.database.dbname=foodapp

# PostgreSQL CDC Configuration
debezium.source.plugin.name=pgoutput
debezium.source.slot.name=debezium_slot_ubear_pubsub
debezium.source.publication.name=dbz_publication_ubear

# Topic naming
debezium.source.topic.prefix=dbserver1

# Tables to capture
debezium.source.table.include.list=public.eater,public.merchant,public.courier,public.trip_events

# Schema changes
debezium.source.include.schema.changes=true

# Snapshot mode (initial load)
debezium.source.snapshot.mode=initial

# =============================================================================
# Debezium Sink - Google Cloud Pub/Sub
# =============================================================================
debezium.sink.type=pubsub
debezium.sink.pubsub.project.id=gentle-voltage-478517-q0

# Topic mapping avec transformation
# dbserver1.public.eater -> ubear-eater-cdc
# dbserver1.public.merchant -> ubear-merchant-cdc
# dbserver1.public.courier -> ubear-courier-cdc
# dbserver1.public.trip_events -> ubear-trip-events-cdc

# Ordre des messages
debezium.sink.pubsub.ordering.enabled=true

# =============================================================================
# Format Configuration
# =============================================================================
debezium.format.key=json
debezium.format.value=json

# =============================================================================
# Transforms - Router pour renommer les topics
# =============================================================================
debezium.transforms=route
debezium.transforms.route.type=io.debezium.transforms.ByLogicalTableRouter
debezium.transforms.route.topic.regex=dbserver1\\.public\\.(.*)
debezium.transforms.route.topic.replacement=ubear-$1-cdc

# =============================================================================
# Logging
# =============================================================================
quarkus.log.level=INFO
quarkus.log.console.enable=true
quarkus.log.console.json=false

# =============================================================================
# Error Handling
# =============================================================================
debezium.source.errors.max.retries=3
debezium.source.errors.retry.delay.initial.ms=1000
debezium.source.errors.retry.delay.max.ms=30000

# =============================================================================
# Performance Tuning
# =============================================================================
debezium.source.max.batch.size=2048
debezium.source.max.queue.size=8192
debezium.source.poll.interval.ms=500
